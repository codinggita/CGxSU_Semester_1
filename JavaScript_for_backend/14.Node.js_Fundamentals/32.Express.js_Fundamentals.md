# Express.js Fundamentals

**Difficulty:** Intermediate
**Estimated Time:** 95-110 minutes
**Prerequisites:** Node.js basics, HTTP servers, async/await, routing concepts
**Target:** Express 4.18+ with Node.js 18+ LTS

---

## Learning Objectives

By the end of this lesson, you will be able to:

1. Set up an Express.js application from scratch
2. Create routes for different HTTP methods
3. Work with route parameters and query strings
4. Understand and implement middleware
5. Use built-in middleware (express.json, express.static)
6. Create custom middleware functions
7. Implement error handling middleware
8. Validate and sanitize request data
9. Structure Express applications properly
10. Build production-ready Express APIs

---

## Table of Contents

1. [Introduction](#introduction)
2. [Setting Up Express](#setting-up-express)
3. [Routing Basics](#routing-basics)
4. [Route Parameters](#route-parameters)
5. [Query Strings](#query-strings)
6. [Middleware Concept](#middleware-concept)
7. [Built-in Middleware](#built-in-middleware)
8. [Custom Middleware](#custom-middleware)
9. [Error Handling](#error-handling)
10. [Request Validation](#request-validation)
11. [Worked Examples](#worked-examples)
12. [Exercises](#exercises)
13. [Testing & Verification](#testing--verification)
14. [Best Practices](#best-practices)
15. [Common Pitfalls](#common-pitfalls)
16. [Performance Considerations](#performance-considerations)
17. [Summary & Next Steps](#summary--next-steps)
18. [References](#references)

---

## Introduction

**Express.js** is the most popular web framework for Node.js. It simplifies routing, middleware management, and HTTP request handling compared to the raw http module.

**Why Express Matters:**

- **Simplicity:** Clean, intuitive API
- **Middleware:** Powerful plugin system
- **Routing:** Elegant routing mechanism
- **Community:** Massive ecosystem of middleware
- **Performance:** Minimal overhead
- **Battle-tested:** Powers millions of applications

**Real-World Users:**

- **Uber:** API backend
- **Twitter:** Mobile API
- **IBM:** Cloud services
- **Accenture:** Enterprise applications
- **Fox Sports:** Real-time sports data

---

## Setting Up Express

### Installation

```bash
# Create new project
mkdir my-express-app
cd my-express-app

# Initialize package.json
npm init -y

# Install Express
npm install express

# Install dev dependencies
npm install --save-dev nodemon

# Update package.json scripts
npm pkg set scripts.start="node server.js"
npm pkg set scripts.dev="nodemon server.js"
```

### Basic Express App

```javascript
/**
 * server.js - Minimal Express application
 */

const express = require('express');
const app = express();

const PORT = process.env.PORT || 3000;

// Basic route
app.get('/', (req, res) => {
  res.send('Hello, Express!');
});

// Start server
app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});

// Run with: npm start
// Or with auto-reload: npm run dev
```

### Structured Express App

```javascript
/**
 * app.js - Better structured Express application
 */

const express = require('express');
const app = express();

// ===== MIDDLEWARE =====
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Logging middleware
app.use((req, res, next) => {
  console.log(`${req.method} ${req.url}`);
  next();
});

// ===== ROUTES =====
app.get('/', (req, res) => {
  res.json({
    message: 'Welcome to Express API',
    version: '1.0.0',
    endpoints: {
      health: '/health',
      users: '/api/users',
      posts: '/api/posts'
    }
  });
});

app.get('/health', (req, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

// 404 handler
app.use((req, res) => {
  res.status(404).json({ error: 'Route not found' });
});

// Error handler
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Internal server error' });
});

// Export app for testing
module.exports = app;

// Start server if not in test mode
if (require.main === module) {
  const PORT = process.env.PORT || 3000;
  app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
  });
}
```

---

## Routing Basics

### HTTP Methods

```javascript
/**
 * routes/basic.js - Basic routing examples
 */

const express = require('express');
const app = express();

// GET request
app.get('/users', (req, res) => {
  res.json({ users: ['John', 'Jane', 'Bob'] });
});

// POST request
app.post('/users', (req, res) => {
  const user = req.body;
  res.status(201).json({
    message: 'User created',
    user
  });
});

// PUT request
app.put('/users/:id', (req, res) => {
  const { id } = req.params;
  const user = req.body;
  res.json({
    message: 'User updated',
    id,
    user
  });
});

// PATCH request
app.patch('/users/:id', (req, res) => {
  const { id } = req.params;
  const updates = req.body;
  res.json({
    message: 'User partially updated',
    id,
    updates
  });
});

// DELETE request
app.delete('/users/:id', (req, res) => {
  const { id } = req.params;
  res.json({
    message: 'User deleted',
    id
  });
});

// Multiple methods on same route
app.route('/items')
  .get((req, res) => {
    res.json({ items: [] });
  })
  .post((req, res) => {
    res.status(201).json({ message: 'Item created' });
  });

module.exports = app;
```

### Express Router

```javascript
/**
 * routes/users.js - Using Express Router
 */

const express = require('express');
const router = express.Router();

// Middleware specific to this router
router.use((req, res, next) => {
  console.log('User route accessed:', Date.now());
  next();
});

// GET /users
router.get('/', (req, res) => {
  res.json({
    users: [
      { id: 1, name: 'John', email: 'john@example.com' },
      { id: 2, name: 'Jane', email: 'jane@example.com' }
    ]
  });
});

// GET /users/:id
router.get('/:id', (req, res) => {
  const { id } = req.params;
  res.json({
    id,
    name: 'John',
    email: 'john@example.com'
  });
});

// POST /users
router.post('/', (req, res) => {
  const { name, email } = req.body;

  if (!name || !email) {
    return res.status(400).json({
      error: 'Name and email are required'
    });
  }

  res.status(201).json({
    id: 3,
    name,
    email
  });
});

// PUT /users/:id
router.put('/:id', (req, res) => {
  const { id } = req.params;
  const { name, email } = req.body;

  res.json({
    id,
    name,
    email,
    updated: true
  });
});

// DELETE /users/:id
router.delete('/:id', (req, res) => {
  const { id } = req.params;
  res.json({
    message: 'User deleted',
    id
  });
});

module.exports = router;

// ===== app.js =====
// const express = require('express');
// const userRoutes = require('./routes/users');
// const app = express();
//
// app.use(express.json());
// app.use('/api/users', userRoutes);  // Mount router
//
// app.listen(3000);
```

---

## Route Parameters

### URL Parameters

```javascript
/**
 * Route parameters examples
 */

const express = require('express');
const app = express();

// Single parameter
app.get('/users/:userId', (req, res) => {
  const { userId } = req.params;
  res.json({ userId });
});

// Multiple parameters
app.get('/users/:userId/posts/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.json({ userId, postId });
});

// Optional parameter
app.get('/posts/:year/:month?', (req, res) => {
  const { year, month } = req.params;
  res.json({
    year,
    month: month || 'all'
  });
});

// Parameter with regex
app.get('/users/:id(\\d+)', (req, res) => {
  // Only matches numeric IDs
  const { id } = req.params;
  res.json({ id: parseInt(id) });
});

// Wildcard
app.get('/files/*', (req, res) => {
  // req.params[0] contains everything after /files/
  const filePath = req.params[0];
  res.json({ filePath });
});

// Parameter validation middleware
app.param('userId', (req, res, next, id) => {
  console.log('Validating userId:', id);

  // Validate ID format
  if (!/^\d+$/.test(id)) {
    return res.status(400).json({ error: 'Invalid user ID' });
  }

  // Attach validated ID
  req.userId = parseInt(id);
  next();
});

app.get('/users/:userId', (req, res) => {
  // req.userId is already validated and parsed
  res.json({ userId: req.userId });
});

module.exports = app;
```

---

## Query Strings

### Working with Query Parameters

```javascript
/**
 * Query string handling
 */

const express = require('express');
const app = express();

// Basic query parameters
// Example: /search?q=nodejs&limit=10
app.get('/search', (req, res) => {
  const { q, limit = 10, page = 1 } = req.query;

  res.json({
    query: q,
    limit: parseInt(limit),
    page: parseInt(page),
    results: []
  });
});

// Multiple values
// Example: /filter?tags=node&tags=javascript&tags=express
app.get('/filter', (req, res) => {
  let { tags } = req.query;

  // Ensure tags is always an array
  if (typeof tags === 'string') {
    tags = [tags];
  }

  res.json({ tags: tags || [] });
});

// Complex filtering
// Example: /products?category=electronics&minPrice=100&maxPrice=500&sort=price&order=asc
app.get('/products', (req, res) => {
  const {
    category,
    minPrice,
    maxPrice,
    sort = 'name',
    order = 'asc',
    page = 1,
    limit = 20
  } = req.query;

  const filters = {
    category,
    priceRange: {
      min: minPrice ? parseFloat(minPrice) : 0,
      max: maxPrice ? parseFloat(maxPrice) : Infinity
    },
    sort: {
      field: sort,
      order: order.toLowerCase()
    },
    pagination: {
      page: parseInt(page),
      limit: parseInt(limit),
      offset: (parseInt(page) - 1) * parseInt(limit)
    }
  };

  res.json({ filters, products: [] });
});

// Boolean query params
// Example: /posts?published=true&featured=false
app.get('/posts', (req, res) => {
  const published = req.query.published === 'true';
  const featured = req.query.featured === 'true';

  res.json({ published, featured, posts: [] });
});

module.exports = app;
```

---

## Middleware Concept

### Understanding Middleware

```javascript
/**
 * Middleware flow in Express
 *
 * Request → Middleware 1 → Middleware 2 → Route Handler → Response
 *               ↓              ↓               ↓
 *            next()         next()          res.send()
 */

const express = require('express');
const app = express();

// Middleware 1: Logger
app.use((req, res, next) => {
  console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);
  next(); // Pass control to next middleware
});

// Middleware 2: Request timing
app.use((req, res, next) => {
  req.startTime = Date.now();
  next();
});

// Middleware 3: Add custom header
app.use((req, res, next) => {
  res.setHeader('X-Powered-By', 'Express');
  next();
});

// Route handler
app.get('/', (req, res) => {
  const duration = Date.now() - req.startTime;
  res.json({
    message: 'Hello',
    duration: `${duration}ms`
  });
});

// Middleware execution order matters!
app.use((req, res, next) => {
  console.log('This runs after route handler if next() is called');
  next();
});
```

### Middleware Types

```javascript
/**
 * Different types of middleware
 */

const express = require('express');
const app = express();

// 1. APPLICATION-LEVEL MIDDLEWARE
app.use((req, res, next) => {
  console.log('Application middleware');
  next();
});

// 2. ROUTER-LEVEL MIDDLEWARE
const router = express.Router();
router.use((req, res, next) => {
  console.log('Router middleware');
  next();
});

// 3. BUILT-IN MIDDLEWARE
app.use(express.json());
app.use(express.static('public'));

// 4. THIRD-PARTY MIDDLEWARE
// const cors = require('cors');
// app.use(cors());

// 5. ERROR-HANDLING MIDDLEWARE (4 parameters!)
app.use((err, req, res, next) => {
  console.error(err);
  res.status(500).json({ error: err.message });
});

// 6. ROUTE-SPECIFIC MIDDLEWARE
function authMiddleware(req, res, next) {
  const token = req.headers.authorization;
  if (!token) {
    return res.status(401).json({ error: 'No token' });
  }
  next();
}

app.get('/protected', authMiddleware, (req, res) => {
  res.json({ message: 'Protected route' });
});

// 7. MULTIPLE MIDDLEWARE
app.get('/multi',
  (req, res, next) => { console.log('MW 1'); next(); },
  (req, res, next) => { console.log('MW 2'); next(); },
  (req, res) => { res.send('Done'); }
);
```

---

## Built-in Middleware

### express.json()

```javascript
/**
 * express.json() - Parse JSON request bodies
 */

const express = require('express');
const app = express();

// Parse JSON bodies (application/json)
app.use(express.json({
  limit: '10mb',           // Max body size
  strict: true,            // Only parse arrays and objects
  type: 'application/json' // Content-Type to parse
}));

app.post('/api/data', (req, res) => {
  // req.body contains parsed JSON
  console.log(req.body);
  res.json({
    received: req.body
  });
});

// Test with:
// curl -X POST http://localhost:3000/api/data \
//   -H "Content-Type: application/json" \
//   -d '{"name":"John","age":30}'
```

### express.urlencoded()

```javascript
/**
 * express.urlencoded() - Parse URL-encoded bodies
 */

app.use(express.urlencoded({
  extended: true,  // Use qs library (supports nested objects)
  limit: '10mb'
}));

app.post('/form', (req, res) => {
  // req.body contains parsed form data
  console.log(req.body);
  res.json({ received: req.body });
});

// Test with:
// curl -X POST http://localhost:3000/form \
//   -d "name=John&age=30"
```

### express.static()

```javascript
/**
 * express.static() - Serve static files
 */

const path = require('path');

// Serve files from 'public' directory
app.use(express.static('public'));

// Custom path and options
app.use('/static', express.static('public', {
  maxAge: '1d',           // Cache for 1 day
  index: 'index.html',    // Default file
  dotfiles: 'ignore',     // Ignore hidden files
  etag: true,             // Enable ETags
  lastModified: true      // Enable Last-Modified header
}));

// Multiple static directories
app.use(express.static('public'));
app.use(express.static('uploads'));

/**
 * Directory structure:
 * public/
 *   ├── index.html
 *   ├── styles.css
 *   └── app.js
 *
 * Access: http://localhost:3000/index.html
 *         http://localhost:3000/styles.css
 */
```

---

## Custom Middleware

### Creating Custom Middleware

```javascript
/**
 * middleware/logger.js - Custom logging middleware
 */

function logger(options = {}) {
  const { format = 'default' } = options;

  return (req, res, next) => {
    const start = Date.now();

    // Log when response finishes
    res.on('finish', () => {
      const duration = Date.now() - start;

      if (format === 'json') {
        console.log(JSON.stringify({
          timestamp: new Date().toISOString(),
          method: req.method,
          url: req.url,
          status: res.statusCode,
          duration: `${duration}ms`,
          ip: req.ip
        }));
      } else {
        console.log(
          `[${new Date().toISOString()}] ` +
          `${req.method} ${req.url} ` +
          `${res.statusCode} ${duration}ms`
        );
      }
    });

    next();
  };
}

module.exports = logger;

// Usage
// const logger = require('./middleware/logger');
// app.use(logger({ format: 'json' }));
```

### Authentication Middleware

```javascript
/**
 * middleware/auth.js - Authentication middleware
 */

function authenticate(req, res, next) {
  const token = req.headers.authorization?.replace('Bearer ', '');

  if (!token) {
    return res.status(401).json({
      error: 'Authentication required'
    });
  }

  try {
    // Verify token (simplified)
    // const decoded = jwt.verify(token, SECRET);
    // req.user = decoded;

    // For demo purposes
    req.user = { id: 1, name: 'John' };
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
}

// Role-based authorization
function authorize(...roles) {
  return (req, res, next) => {
    if (!req.user) {
      return res.status(401).json({ error: 'Not authenticated' });
    }

    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ error: 'Forbidden' });
    }

    next();
  };
}

module.exports = { authenticate, authorize };

// Usage
// const { authenticate, authorize } = require('./middleware/auth');
//
// app.get('/admin', authenticate, authorize('admin'), (req, res) => {
//   res.json({ message: 'Admin area' });
// });
```

### Rate Limiting Middleware

```javascript
/**
 * middleware/rateLimiter.js - Rate limiting
 */

function rateLimiter(options = {}) {
  const {
    windowMs = 15 * 60 * 1000, // 15 minutes
    max = 100,                   // Max requests per window
    message = 'Too many requests'
  } = options;

  const requests = new Map();

  return (req, res, next) => {
    const key = req.ip;
    const now = Date.now();

    // Get or create request tracking
    let tracker = requests.get(key);
    if (!tracker) {
      tracker = { count: 0, resetTime: now + windowMs };
      requests.set(key, tracker);
    }

    // Reset if window expired
    if (now > tracker.resetTime) {
      tracker.count = 0;
      tracker.resetTime = now + windowMs;
    }

    // Increment count
    tracker.count++;

    // Set rate limit headers
    res.setHeader('X-RateLimit-Limit', max);
    res.setHeader('X-RateLimit-Remaining', Math.max(0, max - tracker.count));
    res.setHeader('X-RateLimit-Reset', new Date(tracker.resetTime).toISOString());

    // Check limit
    if (tracker.count > max) {
      return res.status(429).json({
        error: message,
        retryAfter: Math.ceil((tracker.resetTime - now) / 1000)
      });
    }

    next();
  };
}

module.exports = rateLimiter;

// Usage
// const rateLimiter = require('./middleware/rateLimiter');
// app.use('/api', rateLimiter({ max: 100, windowMs: 15 * 60 * 1000 }));
```

---

## Error Handling

### Error Handling Middleware

```javascript
/**
 * Error handling in Express
 */

const express = require('express');
const app = express();

app.use(express.json());

// Async error handling wrapper
function asyncHandler(fn) {
  return (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
}

// Route with error
app.get('/error', asyncHandler(async (req, res) => {
  throw new Error('Something went wrong!');
}));

// Custom error class
class AppError extends Error {
  constructor(message, statusCode) {
    super(message);
    this.statusCode = statusCode;
    this.isOperational = true;
    Error.captureStackTrace(this, this.constructor);
  }
}

// Route with custom error
app.get('/not-found', asyncHandler(async (req, res) => {
  throw new AppError('Resource not found', 404);
}));

// 404 handler (no matching route)
app.use((req, res, next) => {
  res.status(404).json({
    error: 'Route not found',
    path: req.url
  });
});

// Global error handler
app.use((err, req, res, next) => {
  console.error('Error:', err);

  // Determine status code
  const statusCode = err.statusCode || 500;

  // Send error response
  res.status(statusCode).json({
    error: {
      message: err.message,
      ...(process.env.NODE_ENV === 'development' && {
        stack: err.stack
      })
    }
  });
});

module.exports = app;
```

### Advanced Error Handling

```javascript
/**
 * middleware/errorHandler.js - Advanced error handling
 */

class ErrorHandler {
  handleError(err, req, res, next) {
    // Log error
    this.logError(err);

    // Determine error type and response
    if (err.name === 'ValidationError') {
      return this.handleValidationError(err, res);
    }

    if (err.name === 'CastError') {
      return this.handleCastError(err, res);
    }

    if (err.code === 11000) {
      return this.handleDuplicateKeyError(err, res);
    }

    // Default error
    res.status(err.statusCode || 500).json({
      success: false,
      error: process.env.NODE_ENV === 'production'
        ? 'Internal server error'
        : err.message,
      ...(process.env.NODE_ENV === 'development' && {
        stack: err.stack
      })
    });
  }

  logError(err) {
    console.error(`[${new Date().toISOString()}] ERROR:`, {
      message: err.message,
      stack: err.stack,
      name: err.name
    });

    // Send to error tracking service (Sentry, etc.)
    // errorTrackingService.captureException(err);
  }

  handleValidationError(err, res) {
    const errors = Object.values(err.errors).map(e => e.message);
    res.status(400).json({
      success: false,
      error: 'Validation failed',
      details: errors
    });
  }

  handleCastError(err, res) {
    res.status(400).json({
      success: false,
      error: `Invalid ${err.path}: ${err.value}`
    });
  }

  handleDuplicateKeyError(err, res) {
    const field = Object.keys(err.keyValue)[0];
    res.status(409).json({
      success: false,
      error: `${field} already exists`
    });
  }
}

const errorHandler = new ErrorHandler();
module.exports = errorHandler.handleError.bind(errorHandler);
```

---

## Request Validation

### Input Validation

```javascript
/**
 * middleware/validation.js - Request validation
 */

function validateUser(req, res, next) {
  const { name, email, age } = req.body;

  const errors = [];

  // Validate name
  if (!name || typeof name !== 'string') {
    errors.push('Name is required and must be a string');
  } else if (name.length < 2 || name.length > 50) {
    errors.push('Name must be between 2 and 50 characters');
  }

  // Validate email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailRegex.test(email)) {
    errors.push('Valid email is required');
  }

  // Validate age
  if (age !== undefined) {
    const ageNum = parseInt(age);
    if (isNaN(ageNum) || ageNum < 0 || ageNum > 150) {
      errors.push('Age must be a number between 0 and 150');
    }
  }

  if (errors.length > 0) {
    return res.status(400).json({
      success: false,
      errors
    });
  }

  next();
}

module.exports = { validateUser };

// Usage
// const { validateUser } = require('./middleware/validation');
// app.post('/users', validateUser, (req, res) => {
//   // req.body is validated
//   res.json({ success: true });
// });
```

### Using Validation Libraries

```javascript
/**
 * Using express-validator (install: npm install express-validator)
 */

const { body, validationResult } = require('express-validator');

const validateUserRules = [
  body('name')
    .trim()
    .notEmpty().withMessage('Name is required')
    .isLength({ min: 2, max: 50 }).withMessage('Name must be 2-50 characters'),

  body('email')
    .trim()
    .notEmpty().withMessage('Email is required')
    .isEmail().withMessage('Invalid email')
    .normalizeEmail(),

  body('age')
    .optional()
    .isInt({ min: 0, max: 150 }).withMessage('Age must be 0-150')
    .toInt(),

  body('password')
    .notEmpty().withMessage('Password is required')
    .isLength({ min: 8 }).withMessage('Password must be at least 8 characters')
    .matches(/[A-Z]/).withMessage('Password must contain uppercase letter')
    .matches(/[a-z]/).withMessage('Password must contain lowercase letter')
    .matches(/[0-9]/).withMessage('Password must contain number')
];

function validate(req, res, next) {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      success: false,
      errors: errors.array()
    });
  }
  next();
}

// Usage
app.post('/users', validateUserRules, validate, (req, res) => {
  res.json({ success: true, user: req.body });
});
```

---

## Worked Examples

### Example 1: Complete REST API

```javascript
/**
 * Complete Express REST API
 */

const express = require('express');
const app = express();

// Middleware
app.use(express.json());

// In-memory database
let users = [
  { id: 1, name: 'John', email: 'john@example.com' },
  { id: 2, name: 'Jane', email: 'jane@example.com' }
];
let nextId = 3;

// Routes
// GET /api/users - Get all users
app.get('/api/users', (req, res) => {
  res.json({ users });
});

// GET /api/users/:id - Get user by ID
app.get('/api/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));
  if (!user) {
    return res.status(404).json({ error: 'User not found' });
  }
  res.json({ user });
});

// POST /api/users - Create user
app.post('/api/users', (req, res) => {
  const { name, email } = req.body;

  if (!name || !email) {
    return res.status(400).json({ error: 'Name and email required' });
  }

  const user = { id: nextId++, name, email };
  users.push(user);

  res.status(201).json({ user });
});

// PUT /api/users/:id - Update user
app.put('/api/users/:id', (req, res) => {
  const { id } = req.params;
  const { name, email } = req.body;

  const index = users.findIndex(u => u.id === parseInt(id));
  if (index === -1) {
    return res.status(404).json({ error: 'User not found' });
  }

  users[index] = { id: parseInt(id), name, email };
  res.json({ user: users[index] });
});

// DELETE /api/users/:id - Delete user
app.delete('/api/users/:id', (req, res) => {
  const { id } = req.params;

  const index = users.findIndex(u => u.id === parseInt(id));
  if (index === -1) {
    return res.status(404).json({ error: 'User not found' });
  }

  users.splice(index, 1);
  res.json({ message: 'User deleted' });
});

app.listen(3000, () => console.log('Server running on port 3000'));
```

---

## Exercises

### Exercise 1: Basic Express Server (Beginner)

**Task:** Create a basic Express server with multiple routes.

**Requirements:**
1. Create /home, /about, /contact routes
2. Add a 404 handler
3. Implement logging middleware
4. Serve static files from /public
5. Add CORS headers
6. Create /api/info route returning JSON

**Solution:** See `solutions/exercise1-basic-server.js`

---

### Exercise 2: User Management API (Intermediate)

**Task:** Build a complete user management API.

**Requirements:**
1. CRUD operations for users
2. Input validation
3. Error handling
4. Search and filtering
5. Pagination support
6. Custom middleware for logging
7. Rate limiting

**Solution:** See `solutions/exercise2-user-api.js`

---

### Exercise 3: Blog API with Authentication (Advanced)

**Task:** Create a blog API with authentication.

**Requirements:**
1. User registration and login
2. JWT authentication
3. Create, read, update, delete posts
4. Comment system
5. Authorization (users can only edit their own posts)
6. File upload for images
7. Search and pagination
8. Role-based access control

**Solution:** See `solutions/exercise3-blog-api/`

---

## Best Practices

### 1. Structure Your Application

```javascript
// ✅ DO: Organized structure
project/
  ├── src/
  │   ├── routes/
  │   ├── controllers/
  │   ├── middleware/
  │   ├── models/
  │   └── utils/
  ├── tests/
  ├── .env
  └── server.js

// ❌ DON'T: Everything in one file
```

### 2. Use Async/Await

```javascript
// ✅ DO
app.get('/users', async (req, res, next) => {
  try {
    const users = await User.find();
    res.json({ users });
  } catch (error) {
    next(error);
  }
});

// ❌ DON'T: Callback hell
app.get('/users', (req, res) => {
  User.find((err, users) => {
    if (err) return res.status(500).send(err);
    res.json({ users });
  });
});
```

### 3. Always Handle Errors

```javascript
// ✅ DO: Comprehensive error handling
app.use((err, req, res, next) => {
  console.error(err);
  res.status(err.statusCode || 500).json({ error: err.message });
});

// ❌ DON'T: Ignore errors
```

---

## Common Pitfalls

### 1. Forgetting next()

```javascript
// ❌ PITFALL: Request hangs
app.use((req, res, next) => {
  console.log('Middleware');
  // Forgot next()!
});

// ✅ SOLUTION
app.use((req, res, next) => {
  console.log('Middleware');
  next();
});
```

### 2. Middleware Order

```javascript
// ❌ PITFALL: JSON parser after routes
app.get('/api/data', (req, res) => {
  console.log(req.body); // undefined!
});
app.use(express.json());

// ✅ SOLUTION: Middleware first
app.use(express.json());
app.get('/api/data', (req, res) => {
  console.log(req.body); // Works!
});
```

---

## Summary & Next Steps

### Key Takeaways

1. **Express** simplifies Node.js web development
2. **Middleware** is the core concept
3. **Routing** is clean and powerful
4. **Error handling** is crucial
5. **Validation** prevents bad data

### What's Next?

- **RESTful API Design**: Best practices for API design
- **Database Integration**: MongoDB, PostgreSQL
- **Authentication**: JWT, OAuth, sessions

---

## References

- [Express Documentation](https://expressjs.com/)
- [Express Router](https://expressjs.com/en/guide/routing.html)
- [Express Middleware](https://expressjs.com/en/guide/using-middleware.html)

---

**Next Lesson:** [33. RESTful API Design](./33.RESTful_API_Design.md)

**Previous Lesson:** [31. HTTP and Servers](./31.HTTP_And_Servers.md)
