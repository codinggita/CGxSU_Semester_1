# Node.js Introduction and Setup

**Difficulty:** Beginner to Intermediate
**Estimated Time:** 75-90 minutes
**Prerequisites:** JavaScript fundamentals, command line basics
**Target:** Node.js 18+ LTS

---

## Learning Objectives

By the end of this lesson, you will be able to:

1. Understand what Node.js is and how it differs from browser JavaScript
2. Explain the V8 engine, event-driven architecture, and non-blocking I/O
3. Install Node.js and choose between npm, pnpm, and yarn
4. Create and configure package.json files
5. Manage dependencies and understand node_modules
6. Write and execute npm scripts
7. Apply semantic versioning (semver) principles
8. Use npx and manage global packages
9. Set up a professional Node.js project from scratch
10. Troubleshoot common Node.js installation and setup issues

---

## Table of Contents

1. [Introduction](#introduction)
2. [What is Node.js](#what-is-nodejs)
3. [Node.js vs Browser JavaScript](#nodejs-vs-browser-javascript)
4. [Installing Node.js](#installing-nodejs)
5. [Package Managers: npm, pnpm, yarn](#package-managers)
6. [package.json Deep Dive](#packagejson-deep-dive)
7. [npm Scripts](#npm-scripts)
8. [node_modules and Dependencies](#node_modules-and-dependencies)
9. [Semantic Versioning](#semantic-versioning)
10. [npx and Global Packages](#npx-and-global-packages)
11. [Worked Examples](#worked-examples)
12. [Exercises](#exercises)
13. [Testing & Verification](#testing--verification)
14. [Best Practices](#best-practices)
15. [Common Pitfalls](#common-pitfalls)
16. [Summary & Next Steps](#summary--next-steps)
17. [References](#references)

---

## Introduction

**Node.js** is a JavaScript runtime built on Chrome's V8 JavaScript engine that allows you to run JavaScript on the server side. Released in 2009 by Ryan Dahl, Node.js revolutionized JavaScript by enabling full-stack JavaScript development.

**Why Node.js Matters:**

- **Unified Language:** Use JavaScript for both frontend and backend
- **High Performance:** Non-blocking I/O enables handling thousands of concurrent connections
- **Rich Ecosystem:** npm hosts over 2 million packages
- **Real-time Applications:** Perfect for chat apps, live updates, streaming
- **Microservices:** Lightweight and fast, ideal for modern architectures
- **Developer Productivity:** Fast development cycles and hot reloading

**Real-World Applications:**

- **Netflix:** Reduced startup time by 70% using Node.js
- **PayPal:** Doubled requests per second compared to Java
- **LinkedIn:** Moved from Ruby on Rails to Node.js, 20x faster
- **Uber:** Processes millions of RPCs (Remote Procedure Calls)
- **NASA:** Uses Node.js to keep astronauts safe during space walks

---

## What is Node.js

### The V8 Engine

Node.js uses **V8**, Google's open-source JavaScript engine written in C++:

```javascript
/**
 * V8 Engine Architecture
 *
 * JavaScript Code ‚Üí Parser ‚Üí AST ‚Üí Interpreter (Ignition) ‚Üí Bytecode
 *                                          ‚Üì
 *                              Optimizing Compiler (TurboFan)
 *                                          ‚Üì
 *                                  Machine Code (Executed)
 */

// V8 compiles JavaScript to machine code for faster execution
console.time('v8-performance');
let sum = 0;
for (let i = 0; i < 1000000; i++) {
  sum += i;
}
console.timeEnd('v8-performance');
// Typically completes in milliseconds due to V8 optimizations
```

### Event-Driven Architecture

Node.js is built on an **event-driven, non-blocking I/O model**:

```javascript
/**
 * Event-Driven Architecture Example
 */

// Traditional blocking approach (NOT Node.js)
// const data = readFileSync('file.txt'); // Blocks until complete
// console.log(data);
// console.log('Next operation'); // Waits for file read

// Node.js non-blocking approach
const fs = require('fs');

console.log('Start reading file...');

fs.readFile('file.txt', 'utf8', (err, data) => {
  if (err) throw err;
  console.log('File contents:', data);
});

console.log('Doing other work...'); // Executes immediately!

// Output order:
// Start reading file...
// Doing other work...
// File contents: [file data]
```

### Non-Blocking I/O

```javascript
/**
 * Non-Blocking I/O Demonstration
 * Shows how Node.js handles multiple operations concurrently
 */

const fs = require('fs').promises;

async function handleMultipleOperations() {
  console.log('Starting multiple I/O operations...');
  const startTime = Date.now();

  // These run concurrently, not sequentially!
  const [file1, file2, file3] = await Promise.all([
    fs.readFile('file1.txt', 'utf8'),
    fs.readFile('file2.txt', 'utf8'),
    fs.readFile('file3.txt', 'utf8')
  ]);

  const endTime = Date.now();
  console.log(`Completed in ${endTime - startTime}ms`);
  // Much faster than reading sequentially!
}

/**
 * The Event Loop
 *
 * ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 * ‚îÇ       Timers Phase        ‚îÇ ‚Üê setTimeout, setInterval
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ    Pending Callbacks      ‚îÇ ‚Üê I/O callbacks
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ       Idle, Prepare       ‚îÇ ‚Üê Internal use
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ         Poll Phase        ‚îÇ ‚Üê Retrieve new I/O events
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ        Check Phase        ‚îÇ ‚Üê setImmediate
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ    Close Callbacks        ‚îÇ ‚Üê socket.on('close')
 * ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 */
```

---

## Node.js vs Browser JavaScript

### Key Differences

```javascript
/**
 * Node.js vs Browser JavaScript
 */

// ========================================
// BROWSER JAVASCRIPT
// ========================================

// Global object: window
// console.log(window);

// DOM access
// document.getElementById('myElement');

// Browser APIs
// fetch('https://api.example.com/data');
// localStorage.setItem('key', 'value');

// No file system access (security)
// No direct network server creation

// ========================================
// NODE.JS
// ========================================

// Global object: global (or globalThis)
console.log(global.process.version);

// No DOM (no document or window)
// console.log(document); // ReferenceError!

// File system access
const fs = require('fs');
fs.readFileSync('data.txt', 'utf8');

// Network server creation
const http = require('http');
const server = http.createServer((req, res) => {
  res.end('Hello from Node.js!');
});

// Built-in modules
const path = require('path');
const os = require('os');

// Process and environment
console.log(process.env.NODE_ENV);
console.log(process.argv);
```

### Shared Features

```javascript
/**
 * Features Available in Both Environments
 */

// Core JavaScript (ECMAScript)
const arr = [1, 2, 3];
const doubled = arr.map(x => x * 2);

// Promises and async/await
async function fetchData() {
  // Works in both (with appropriate fetch implementation)
  const response = await fetch('https://api.example.com');
  return response.json();
}

// Modern ES6+ features
const { name, age } = { name: 'John', age: 30 };
const spread = [...arr, 4, 5];

// Console API
console.log('Available everywhere');
console.error('Error logging');
console.table([{ a: 1, b: 2 }]);

// Timers
setTimeout(() => console.log('After 1s'), 1000);
setInterval(() => console.log('Every 2s'), 2000);
```

---

## Installing Node.js

### Method 1: Official Installer

```bash
# Visit https://nodejs.org
# Download LTS version (Long Term Support)
# Run installer

# Verify installation
node --version  # v18.17.0 or higher
npm --version   # 9.6.7 or higher
```

### Method 2: Node Version Manager (nvm) - RECOMMENDED

```bash
# Install nvm (Linux/macOS)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Install nvm (Windows - use nvm-windows)
# Download from https://github.com/coreybutler/nvm-windows

# Install latest LTS
nvm install --lts

# Install specific version
nvm install 18.17.0

# List installed versions
nvm list

# Switch versions
nvm use 18.17.0

# Set default version
nvm alias default 18.17.0
```

### Method 3: Package Managers

```bash
# macOS (Homebrew)
brew install node

# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Windows (Chocolatey)
choco install nodejs-lts

# Verify installation
node --version
npm --version
```

### First Node.js Program

```javascript
/**
 * hello.js - Your first Node.js program
 */

console.log('Hello, Node.js!');
console.log('Node version:', process.version);
console.log('Platform:', process.platform);
console.log('Architecture:', process.arch);

// Run with: node hello.js
```

---

## Package Managers

### npm (Node Package Manager)

```bash
# Comes bundled with Node.js
npm --version

# Initialize new project
npm init          # Interactive
npm init -y       # Default settings

# Install packages
npm install express              # Local dependency
npm install --save-dev jest      # Dev dependency
npm install -g nodemon           # Global package

# Install specific version
npm install express@4.18.2

# Update packages
npm update
npm update express

# Remove packages
npm uninstall express
npm uninstall -g nodemon

# List packages
npm list
npm list --depth=0
npm list -g --depth=0
```

### pnpm (Performant npm) - RECOMMENDED

```bash
# Install pnpm
npm install -g pnpm

# Much faster and disk-space efficient
pnpm install              # Install dependencies
pnpm add express          # Add package
pnpm add -D jest          # Add dev dependency
pnpm remove express       # Remove package
pnpm update               # Update packages

# Advantages:
# - Faster installation (uses hard links)
# - Saves disk space (global store)
# - Strict node_modules structure
```

### Yarn

```bash
# Install Yarn
npm install -g yarn

# Commands
yarn                    # Install dependencies
yarn add express        # Add package
yarn add --dev jest     # Add dev dependency
yarn remove express     # Remove package
yarn upgrade            # Update packages

# Yarn 2+ (Berry)
yarn set version berry
```

### Comparison

```javascript
/**
 * Package Manager Comparison
 */

const comparison = {
  npm: {
    pros: ['Comes with Node.js', 'Most widely used', 'Large community'],
    cons: ['Slower', 'Larger node_modules', 'Phantom dependencies'],
    install: 'npm install',
    usage: 'Good for beginners'
  },

  pnpm: {
    pros: ['Fastest', 'Disk space efficient', 'Strict dependencies'],
    cons: ['Smaller community', 'Some compatibility issues'],
    install: 'npm install -g pnpm',
    usage: 'Best for monorepos and large projects'
  },

  yarn: {
    pros: ['Fast', 'Offline mode', 'Workspaces'],
    cons: ['Extra tool to install', 'Yarn 2+ breaking changes'],
    install: 'npm install -g yarn',
    usage: 'Good for teams needing consistency'
  }
};

console.table(comparison);
```

---

## package.json Deep Dive

### Creating package.json

```bash
# Interactive creation
npm init

# Quick creation with defaults
npm init -y

# Custom defaults
npm config set init-author-name "Your Name"
npm config set init-license "MIT"
```

### Complete package.json Example

```json
{
  "name": "my-awesome-app",
  "version": "1.0.0",
  "description": "A comprehensive Node.js application",
  "main": "index.js",
  "type": "module",
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  },
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write .",
    "build": "tsc",
    "clean": "rm -rf dist"
  },
  "keywords": [
    "node",
    "javascript",
    "backend"
  ],
  "author": "Your Name <your.email@example.com>",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/username/repo.git"
  },
  "bugs": {
    "url": "https://github.com/username/repo/issues"
  },
  "homepage": "https://github.com/username/repo#readme",
  "dependencies": {
    "express": "^4.18.2",
    "dotenv": "^16.0.3"
  },
  "devDependencies": {
    "jest": "^29.5.0",
    "nodemon": "^2.0.22",
    "eslint": "^8.40.0",
    "prettier": "^2.8.8"
  },
  "optionalDependencies": {
    "fsevents": "^2.3.2"
  },
  "peerDependencies": {
    "react": ">=16.8.0"
  },
  "private": false
}
```

### Key Fields Explained

```javascript
/**
 * package.json Fields Breakdown
 */

const packageJsonFields = {
  // ===== ESSENTIAL FIELDS =====
  name: {
    required: true,
    rules: [
      'Lowercase only',
      'No spaces (use hyphens)',
      'Max 214 characters',
      'URL-safe'
    ],
    examples: ['my-app', 'express', '@scope/package']
  },

  version: {
    required: true,
    format: 'MAJOR.MINOR.PATCH',
    example: '1.0.0',
    follows: 'Semantic Versioning (semver)'
  },

  main: {
    description: 'Entry point for your package',
    default: 'index.js',
    example: 'main: "dist/index.js"'
  },

  type: {
    description: 'Module system',
    options: ['module', 'commonjs'],
    default: 'commonjs',
    note: '"module" enables ES6 imports'
  },

  // ===== DEPENDENCY FIELDS =====
  dependencies: {
    description: 'Required for production',
    install: 'npm install package-name',
    example: { express: '^4.18.2' }
  },

  devDependencies: {
    description: 'Only needed for development',
    install: 'npm install -D package-name',
    example: { jest: '^29.5.0' }
  },

  peerDependencies: {
    description: 'Required by your package but installed by user',
    use: 'Plugin development',
    example: { react: '>=16.8.0' }
  },

  optionalDependencies: {
    description: 'Nice to have, not critical',
    behavior: 'Installation failure doesn\'t stop process'
  },

  // ===== METADATA FIELDS =====
  scripts: {
    description: 'Runnable commands',
    run: 'npm run script-name'
  },

  engines: {
    description: 'Specify Node.js/npm version requirements',
    enforced: 'With .npmrc: engine-strict=true'
  }
};
```

---

## npm Scripts

### Basic Scripts

```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest"
  }
}
```

```bash
# Run scripts
npm start        # npm start (no "run" needed)
npm run dev      # npm run <script-name>
npm test         # npm test (no "run" needed)
```

### Advanced Scripts

```json
{
  "scripts": {
    "// Development": "Development scripts",
    "dev": "nodemon --inspect src/server.js",
    "dev:debug": "nodemon --inspect-brk src/server.js",

    "// Testing": "Test scripts",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:e2e": "jest --config jest.e2e.config.js",

    "// Linting & Formatting": "Code quality",
    "lint": "eslint src/**/*.js",
    "lint:fix": "eslint src/**/*.js --fix",
    "format": "prettier --write 'src/**/*.js'",
    "format:check": "prettier --check 'src/**/*.js'",

    "// Building": "Build scripts",
    "prebuild": "npm run clean",
    "build": "babel src -d dist",
    "postbuild": "npm run test",

    "// Deployment": "Deploy scripts",
    "deploy:staging": "npm run build && deploy-staging.sh",
    "deploy:prod": "npm run build && deploy-prod.sh",

    "// Utilities": "Utility scripts",
    "clean": "rm -rf dist coverage",
    "seed": "node scripts/seed-database.js",
    "migrate": "node scripts/run-migrations.js"
  }
}
```

### Script Hooks

```javascript
/**
 * npm Script Lifecycle Hooks
 *
 * Pre and post hooks run automatically:
 * - pretest ‚Üí test ‚Üí posttest
 * - prebuild ‚Üí build ‚Üí postbuild
 * - preinstall ‚Üí install ‚Üí postinstall
 */

// package.json
{
  "scripts": {
    "pretest": "echo 'Running setup before tests'",
    "test": "jest",
    "posttest": "echo 'Cleaning up after tests'",

    "prebuild": "npm run clean && npm run lint",
    "build": "tsc",
    "postbuild": "npm run copy-assets",

    "preinstall": "node check-node-version.js",
    "postinstall": "node setup-husky.js"
  }
}

// Running 'npm test' executes: pretest ‚Üí test ‚Üí posttest
// Running 'npm run build' executes: prebuild ‚Üí build ‚Üí postbuild
```

### Passing Arguments

```bash
# Pass arguments to scripts with --
npm run dev -- --port=3000
npm test -- --watch
npm run lint -- --fix

# Access in script
# "dev": "node server.js"
# node server.js --port=3000
```

---

## node_modules and Dependencies

### Understanding node_modules

```javascript
/**
 * node_modules Structure
 *
 * my-project/
 * ‚îú‚îÄ‚îÄ node_modules/
 * ‚îÇ   ‚îú‚îÄ‚îÄ express/
 * ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
 * ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
 * ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ node_modules/      ‚Üê Nested dependencies
 * ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ body-parser/
 * ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ cookie/
 * ‚îÇ   ‚îú‚îÄ‚îÄ lodash/
 * ‚îÇ   ‚îî‚îÄ‚îÄ .bin/                   ‚Üê Executable scripts
 * ‚îú‚îÄ‚îÄ package.json
 * ‚îî‚îÄ‚îÄ package-lock.json
 */

// Dependencies are installed in node_modules
// Node.js looks for modules here when you require() them

const express = require('express');
// Looks in: ./node_modules/express
// Then: ../node_modules/express
// Then: ../../node_modules/express
// And so on...
```

### package-lock.json

```javascript
/**
 * package-lock.json Purpose
 *
 * - Locks exact versions of all dependencies (including nested)
 * - Ensures consistent installations across environments
 * - Speeds up installation
 * - Should be committed to version control
 */

// package.json
{
  "dependencies": {
    "express": "^4.18.2"  // Can install 4.18.2, 4.18.3, 4.19.0, etc.
  }
}

// package-lock.json
{
  "dependencies": {
    "express": {
      "version": "4.18.2",  // Exact version locked
      "resolved": "https://registry.npmjs.org/express/-/express-4.18.2.tgz",
      "integrity": "sha512-5/PsL6iGPdfQ/lKM1UuielYgv3BUoJfz1aUwU9vHZ+J7gyvwdQXFEBIEIaxeGf0GIcreATNyBExtalisDbuMqQ=="
    }
  }
}
```

### Managing node_modules

```bash
# Install all dependencies
npm install

# Clean install (deletes node_modules first)
npm ci  # Uses package-lock.json exactly

# Audit for vulnerabilities
npm audit
npm audit fix
npm audit fix --force

# Outdated packages
npm outdated

# Deduplicate dependencies
npm dedupe

# Prune (remove extraneous packages)
npm prune
npm prune --production  # Remove devDependencies

# Clean cache
npm cache clean --force
```

---

## Semantic Versioning

### Semver Format

```javascript
/**
 * Semantic Versioning (semver)
 *
 * Format: MAJOR.MINOR.PATCH
 *
 * Example: 2.4.7
 *          ‚îÇ ‚îÇ ‚îî‚îÄ PATCH: Bug fixes (backward compatible)
 *          ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ MINOR: New features (backward compatible)
 *          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAJOR: Breaking changes (NOT backward compatible)
 */

// Version increments:
// 1.0.0 ‚Üí 1.0.1  (Patch: bug fix)
// 1.0.1 ‚Üí 1.1.0  (Minor: new feature)
// 1.1.0 ‚Üí 2.0.0  (Major: breaking change)

// Pre-release versions
// 1.0.0-alpha.1
// 1.0.0-beta.2
// 1.0.0-rc.1  (release candidate)
```

### Version Ranges

```javascript
/**
 * Version Range Syntax
 */

const versionRanges = {
  // EXACT VERSION
  "1.2.3": "Exactly 1.2.3",

  // CARET (^) - Most common, allows MINOR and PATCH updates
  "^1.2.3": ">=1.2.3 <2.0.0",  // 1.2.3, 1.3.0, 1.9.9 ‚úì | 2.0.0 ‚úó
  "^0.2.3": ">=0.2.3 <0.3.0",  // 0.x.x is special (unstable)
  "^0.0.3": ">=0.0.3 <0.0.4",  // Even more restrictive

  // TILDE (~) - Allows PATCH updates only
  "~1.2.3": ">=1.2.3 <1.3.0",  // 1.2.3, 1.2.9 ‚úì | 1.3.0 ‚úó
  "~1.2": ">=1.2.0 <1.3.0",
  "~1": ">=1.0.0 <2.0.0",

  // WILDCARDS
  "*": "Any version",
  "1.x": ">=1.0.0 <2.0.0",
  "1.2.x": ">=1.2.0 <1.3.0",

  // COMPARISON OPERATORS
  ">1.2.3": "Greater than 1.2.3",
  ">=1.2.3": "Greater than or equal",
  "<2.0.0": "Less than 2.0.0",
  "<=1.9.9": "Less than or equal",

  // RANGES
  "1.2.3 - 2.3.4": ">=1.2.3 <=2.3.4",
  "1.2.3 || 2.x": "1.2.3 or any 2.x version",

  // LATEST
  "latest": "Latest published version"
};

// Best practice: Use ^ for most dependencies
{
  "dependencies": {
    "express": "^4.18.2",  // Safe updates
    "exact-package": "1.0.0"  // Critical packages
  }
}
```

---

## npx and Global Packages

### Global Packages

```bash
# Install globally (avoid when possible)
npm install -g nodemon
npm install -g typescript
npm install -g create-react-app

# List global packages
npm list -g --depth=0

# Uninstall global
npm uninstall -g create-react-app

# Problems with global packages:
# - Version conflicts between projects
# - Permission issues
# - Hard to track in package.json
```

### npx - Better Alternative

```bash
# npx runs packages without installing globally

# One-time execution
npx create-react-app my-app
npx cowsay "Hello, Node.js!"

# Run local package binary
npx jest
npx eslint .

# Run specific version
npx create-react-app@latest my-app
npx node@14 script.js

# Execute remote script (be careful!)
npx github:username/repo

# How npx works:
# 1. Checks if command exists in local node_modules/.bin
# 2. If not, checks global packages
# 3. If not, downloads and executes temporarily
# 4. Cleans up after execution
```

### Local vs Global Installation

```javascript
/**
 * Local vs Global Installation Guide
 */

const installationGuide = {
  localInstallation: {
    command: 'npm install package-name',
    location: './node_modules',
    usage: 'Project-specific',
    examples: ['express', 'lodash', 'jest'],
    pros: [
      'Different versions per project',
      'Tracked in package.json',
      'No permission issues',
      'Reproducible builds'
    ]
  },

  globalInstallation: {
    command: 'npm install -g package-name',
    location: '/usr/local/lib/node_modules (or system-specific)',
    usage: 'System-wide CLI tools',
    examples: ['npm', 'yarn', 'pnpm'],
    cons: [
      'Version conflicts',
      'Not in package.json',
      'Permission issues',
      'Hard to reproduce'
    ]
  },

  npxUsage: {
    command: 'npx package-name',
    description: 'Execute without installing',
    benefits: [
      'No global installation needed',
      'Always latest version (or specify)',
      'No leftover files',
      'Perfect for project generators'
    ],
    examples: [
      'npx create-react-app my-app',
      'npx tsc --init',
      'npx http-server'
    ]
  },

  recommendation: 'Use local installation + npx for everything except core tools like npm, nvm'
};
```

---

## Worked Examples

### Example 1: Setting Up a New Project

```bash
# Create project directory
mkdir my-node-app
cd my-node-app

# Initialize with git
git init

# Create .gitignore
cat > .gitignore << EOL
node_modules/
.env
*.log
dist/
coverage/
.DS_Store
EOL

# Initialize package.json
npm init -y

# Install dependencies
npm install express dotenv
npm install -D nodemon jest eslint

# Create directory structure
mkdir -p src/{routes,controllers,models,middleware}
mkdir -p tests

# Create main file
cat > src/server.js << EOL
const express = require('express');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3000;

app.get('/', (req, res) => {
  res.json({ message: 'Hello, Node.js!' });
});

app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}\`);
});
EOL

# Update package.json scripts
npm pkg set scripts.start="node src/server.js"
npm pkg set scripts.dev="nodemon src/server.js"
npm pkg set scripts.test="jest"

# Create .env file
echo "PORT=3000\nNODE_ENV=development" > .env

# Test the setup
npm run dev
```

### Example 2: Managing Dependencies

```javascript
/**
 * dependency-manager.js
 * Script to analyze and manage dependencies
 */

const fs = require('fs');
const { execSync } = require('child_process');

class DependencyManager {
  constructor() {
    this.packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'));
  }

  // List all dependencies
  listDependencies() {
    console.log('\nüì¶ PRODUCTION DEPENDENCIES:');
    const deps = this.packageJson.dependencies || {};
    Object.entries(deps).forEach(([name, version]) => {
      console.log(`  ${name}: ${version}`);
    });

    console.log('\nüîß DEV DEPENDENCIES:');
    const devDeps = this.packageJson.devDependencies || {};
    Object.entries(devDeps).forEach(([name, version]) => {
      console.log(`  ${name}: ${version}`);
    });
  }

  // Check for outdated packages
  checkOutdated() {
    console.log('\nüîç Checking for outdated packages...\n');
    try {
      const result = execSync('npm outdated', { encoding: 'utf8' });
      console.log(result || 'All packages up to date! ‚úÖ');
    } catch (error) {
      // npm outdated exits with 1 if packages are outdated
      console.log(error.stdout);
    }
  }

  // Audit for vulnerabilities
  auditSecurity() {
    console.log('\nüîí Running security audit...\n');
    try {
      const result = execSync('npm audit', { encoding: 'utf8' });
      console.log(result);
    } catch (error) {
      console.log(error.stdout);
    }
  }

  // Get package sizes
  async getPackageSizes() {
    console.log('\nüìä Package sizes:\n');
    const deps = {
      ...this.packageJson.dependencies,
      ...this.packageJson.devDependencies
    };

    for (const [name] of Object.entries(deps)) {
      try {
        const size = this.getDirectorySize(`node_modules/${name}`);
        console.log(`  ${name}: ${this.formatBytes(size)}`);
      } catch (error) {
        console.log(`  ${name}: Not installed`);
      }
    }
  }

  getDirectorySize(dir) {
    const result = execSync(`du -sk ${dir}`, { encoding: 'utf8' });
    const sizeInKB = parseInt(result.split('\t')[0]);
    return sizeInKB * 1024; // Convert to bytes
  }

  formatBytes(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
  }

  // Clean and reinstall
  cleanInstall() {
    console.log('\nüßπ Cleaning node_modules and reinstalling...\n');
    execSync('rm -rf node_modules package-lock.json', { stdio: 'inherit' });
    execSync('npm install', { stdio: 'inherit' });
    console.log('\n‚úÖ Clean install complete!');
  }
}

// Usage
const manager = new DependencyManager();
manager.listDependencies();
manager.checkOutdated();
manager.auditSecurity();

// Run with: node dependency-manager.js
```

### Example 3: Custom npm Scripts Workflow

```json
{
  "name": "advanced-workflow",
  "version": "1.0.0",
  "scripts": {
    "// === DEVELOPMENT ===": "",
    "dev": "run-p dev:server dev:watch",
    "dev:server": "nodemon --exec npm run serve",
    "dev:watch": "npm run watch:css",
    "serve": "node -r dotenv/config src/server.js",

    "// === TESTING ===": "",
    "test": "jest --coverage",
    "test:unit": "jest --testPathPattern=tests/unit",
    "test:integration": "jest --testPathPattern=tests/integration",
    "test:watch": "jest --watch",
    "test:debug": "node --inspect-brk node_modules/.bin/jest --runInBand",

    "// === CODE QUALITY ===": "",
    "lint": "run-p lint:*",
    "lint:js": "eslint 'src/**/*.js'",
    "lint:css": "stylelint 'src/**/*.css'",
    "lint:fix": "eslint 'src/**/*.js' --fix",
    "format": "prettier --write 'src/**/*.{js,json,css,md}'",
    "format:check": "prettier --check 'src/**/*.{js,json,css,md}'",
    "type-check": "tsc --noEmit",

    "// === BUILD ===": "",
    "prebuild": "npm run clean && npm run lint",
    "build": "run-p build:*",
    "build:js": "babel src -d dist",
    "build:css": "postcss src/styles -d dist/styles",
    "postbuild": "npm run test",

    "// === DEPLOYMENT ===": "",
    "predeploy": "npm run build",
    "deploy:staging": "NODE_ENV=staging node scripts/deploy.js",
    "deploy:prod": "NODE_ENV=production node scripts/deploy.js",

    "// === UTILITIES ===": "",
    "clean": "rimraf dist coverage .cache",
    "watch:css": "postcss src/styles -d dist/styles --watch",
    "analyze": "npm run build && webpack-bundle-analyzer dist/stats.json",
    "doctor": "npm run check:all",
    "check:all": "run-s check:*",
    "check:deps": "npm outdated",
    "check:audit": "npm audit",
    "check:licenses": "license-checker --summary"
  },
  "devDependencies": {
    "npm-run-all": "^4.1.5",
    "rimraf": "^5.0.0"
  }
}
```

---

## Exercises

### Exercise 1: Project Setup (Beginner)

**Task:** Set up a professional Node.js project from scratch.

**Requirements:**
1. Create a new directory `todo-api`
2. Initialize git and create .gitignore
3. Initialize npm with custom metadata
4. Install express, dotenv (production)
5. Install nodemon, jest (development)
6. Create src/ directory structure
7. Add npm scripts for start, dev, test
8. Create a basic Express server
9. Create .env file with PORT=3000
10. Test that `npm run dev` works

**Solution:** See `solutions/exercise1-setup.sh`

---

### Exercise 2: Dependency Management (Intermediate)

**Task:** Create a script to analyze project dependencies.

**Requirements:**
1. Read package.json
2. Count total dependencies and devDependencies
3. Check for outdated packages
4. Identify packages with security vulnerabilities
5. Calculate total node_modules size
6. List packages using semantic versioning ranges
7. Suggest packages that could be devDependencies
8. Generate a markdown report

**Solution:** See `solutions/exercise2-dep-analyzer.js`

---

### Exercise 3: npm Scripts Automation (Intermediate)

**Task:** Create a comprehensive npm scripts workflow.

**Requirements:**
1. Pre-commit hook that runs linting
2. Test script with coverage threshold
3. Build script that compiles TypeScript
4. Deploy script with environment validation
5. Custom script to bump version
6. Script to generate changelog
7. Script to check Node.js version compatibility
8. Parallel execution of lint and test

**Solution:** See `solutions/exercise3-npm-scripts.json`

---

### Exercise 4: Version Management (Advanced)

**Task:** Build a version management tool.

**Requirements:**
1. Read current version from package.json
2. Support --major, --minor, --patch flags
3. Update package.json version
4. Create git tag with new version
5. Generate changelog from git commits
6. Update CHANGELOG.md file
7. Validate semver format
8. Prevent version bumps with uncommitted changes

**Solution:** See `solutions/exercise4-version-manager.js`

---

### Exercise 5: Package Publishing (Advanced)

**Task:** Prepare and publish an npm package.

**Requirements:**
1. Create a utility library (string helpers)
2. Configure package.json for publishing
3. Add .npmignore file
4. Create README with usage examples
5. Add LICENSE file (MIT)
6. Set up semantic versioning
7. Configure main, module, types fields
8. Add prepublishOnly script
9. Test locally with `npm link`
10. Publish to npm (or use `npm publish --dry-run`)

**Solution:** See `solutions/exercise5-publish-package/`

---

## Testing & Verification

### Test Suite: setup.test.js

```javascript
/**
 * tests/setup.test.js
 * Tests for Node.js setup validation
 */

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

describe('Node.js Setup', () => {
  describe('Installation', () => {
    test('Node.js is installed', () => {
      const version = execSync('node --version', { encoding: 'utf8' });
      expect(version).toMatch(/v\d+\.\d+\.\d+/);
    });

    test('npm is installed', () => {
      const version = execSync('npm --version', { encoding: 'utf8' });
      expect(version).toMatch(/\d+\.\d+\.\d+/);
    });

    test('Node version is 18 or higher', () => {
      const version = execSync('node --version', { encoding: 'utf8' });
      const major = parseInt(version.match(/v(\d+)/)[1]);
      expect(major).toBeGreaterThanOrEqual(18);
    });
  });

  describe('package.json', () => {
    let packageJson;

    beforeAll(() => {
      const pkgPath = path.join(process.cwd(), 'package.json');
      packageJson = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));
    });

    test('has required fields', () => {
      expect(packageJson).toHaveProperty('name');
      expect(packageJson).toHaveProperty('version');
    });

    test('version follows semver', () => {
      const semverRegex = /^\d+\.\d+\.\d+/;
      expect(packageJson.version).toMatch(semverRegex);
    });

    test('has valid scripts', () => {
      expect(packageJson.scripts).toBeDefined();
      expect(typeof packageJson.scripts).toBe('object');
    });

    test('dependencies are properly formatted', () => {
      if (packageJson.dependencies) {
        Object.values(packageJson.dependencies).forEach(version => {
          expect(typeof version).toBe('string');
        });
      }
    });
  });

  describe('Project Structure', () => {
    test('node_modules exists', () => {
      expect(fs.existsSync('node_modules')).toBe(true);
    });

    test('.gitignore exists and includes node_modules', () => {
      if (fs.existsSync('.gitignore')) {
        const gitignore = fs.readFileSync('.gitignore', 'utf8');
        expect(gitignore).toMatch(/node_modules/);
      }
    });

    test('package-lock.json exists', () => {
      expect(fs.existsSync('package-lock.json')).toBe(true);
    });
  });

  describe('Semantic Versioning', () => {
    test('parses major version', () => {
      const version = '2.4.7';
      const [major] = version.split('.');
      expect(major).toBe('2');
    });

    test('understands caret range', () => {
      const range = '^1.2.3';
      expect(range).toMatch(/^\^/);
      // In real scenario, use semver package to validate ranges
    });

    test('understands tilde range', () => {
      const range = '~1.2.3';
      expect(range).toMatch(/^~/);
    });
  });
});

describe('npx Functionality', () => {
  test('npx is available', () => {
    const result = execSync('npx --version', { encoding: 'utf8' });
    expect(result).toMatch(/\d+\.\d+\.\d+/);
  });

  test('can execute local binaries', () => {
    // This would test if npx can run local node_modules/.bin commands
    expect(true).toBe(true); // Placeholder
  });
});
```

---

## Best Practices

### 1. Project Initialization

```bash
# ‚úÖ DO: Use version control from the start
git init
echo "node_modules/" > .gitignore

# ‚úÖ DO: Use specific Node version
echo "18.17.0" > .nvmrc
nvm use

# ‚úÖ DO: Set engine requirements
npm pkg set engines.node=">=18.0.0"

# ‚ùå DON'T: Commit node_modules
# ‚ùå DON'T: Use outdated Node versions
```

### 2. Dependency Management

```json
{
  "dependencies": {
    // ‚úÖ DO: Use caret for flexibility
    "express": "^4.18.2",

    // ‚úÖ DO: Pin critical packages
    "security-critical": "1.0.0",

    // ‚ùå DON'T: Use wildcards in production
    "bad-package": "*",

    // ‚ùå DON'T: Mix production and dev dependencies
    // Put test frameworks in devDependencies!
  }
}
```

### 3. npm Scripts

```json
{
  "scripts": {
    // ‚úÖ DO: Use descriptive names
    "test:unit": "jest tests/unit",
    "test:integration": "jest tests/integration",

    // ‚úÖ DO: Use pre/post hooks
    "prebuild": "npm run clean",
    "build": "tsc",
    "postbuild": "npm run test",

    // ‚úÖ DO: Handle cross-platform
    "clean": "rimraf dist",  // Not "rm -rf dist"

    // ‚ùå DON'T: Use complex bash in scripts
    "bad": "cd src && ls | grep .js | xargs cat"  // Use a .sh file instead
  }
}
```

### 4. Security

```bash
# ‚úÖ DO: Regular security audits
npm audit
npm audit fix

# ‚úÖ DO: Keep dependencies updated
npm outdated
npm update

# ‚úÖ DO: Use .npmrc for security settings
echo "save-exact=false" >> .npmrc
echo "engine-strict=true" >> .npmrc

# ‚ùå DON'T: Ignore security warnings
# ‚ùå DON'T: Use sudo with npm (fix permissions instead)
```

### 5. Package.json Organization

```json
{
  "name": "my-app",
  "version": "1.0.0",

  // ‚úÖ DO: Group related scripts with comments
  "scripts": {
    "// Build": "",
    "build": "tsc",
    "build:watch": "tsc --watch"
  },

  // ‚úÖ DO: Specify engines
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  },

  // ‚úÖ DO: Add repository info
  "repository": {
    "type": "git",
    "url": "https://github.com/user/repo.git"
  },

  // ‚úÖ DO: Separate dependencies clearly
  "dependencies": {},
  "devDependencies": {}
}
```

---

## Common Pitfalls

### 1. Global Package Hell

```bash
# ‚ùå PROBLEM: Global installations everywhere
npm install -g create-react-app
npm install -g webpack
npm install -g typescript

# ‚úÖ SOLUTION: Use npx
npx create-react-app my-app
npx webpack
npx tsc --init
```

### 2. Version Conflicts

```javascript
/**
 * ‚ùå PROBLEM: Incompatible dependency versions
 */

// package.json
{
  "dependencies": {
    "package-a": "^1.0.0",  // Depends on shared@^2.0.0
    "package-b": "^2.0.0"   // Depends on shared@^1.0.0
    // npm will try to install both versions!
  }
}

// ‚úÖ SOLUTION: Check peer dependencies
npm ls shared
// Align versions or find alternatives
```

### 3. Forgetting package-lock.json

```bash
# ‚ùå PROBLEM: Not committing package-lock.json
echo "package-lock.json" >> .gitignore  # DON'T!

# ‚úÖ SOLUTION: Commit it!
git add package-lock.json
git commit -m "Add package-lock for reproducible builds"

# Why: Ensures everyone installs exact same versions
```

### 4. Incorrect Dependency Classification

```json
{
  // ‚ùå PROBLEM: Dev tools in production dependencies
  "dependencies": {
    "express": "^4.18.2",  // ‚úÖ Correct
    "jest": "^29.5.0",     // ‚ùå Should be in devDependencies
    "nodemon": "^2.0.22"   // ‚ùå Should be in devDependencies
  },

  // ‚úÖ SOLUTION: Classify correctly
  "dependencies": {
    "express": "^4.18.2"
  },
  "devDependencies": {
    "jest": "^29.5.0",
    "nodemon": "^2.0.22"
  }
}
```

### 5. Ignoring npm Warnings

```bash
# ‚ùå PROBLEM: Skipping security warnings
npm WARN deprecated package@1.0.0
npm WARN deprecated Has security vulnerabilities

# ‚úÖ SOLUTION: Address immediately
npm audit fix
# Or find alternative packages
```

---

## Summary & Next Steps

### Key Takeaways

1. **Node.js** enables JavaScript on the server with V8 engine and non-blocking I/O
2. **package.json** is the heart of every Node.js project
3. **npm/pnpm** manage dependencies efficiently
4. **Semantic versioning** ensures predictable updates
5. **npx** executes packages without global installation
6. **npm scripts** automate common tasks

### What's Next?

In the next lesson, we'll explore:
- **Node.js Modules**: CommonJS vs ES Modules
- **require()** and **module.exports**
- Creating and publishing npm packages
- Module resolution algorithm

### Further Practice

1. Set up a complete Node.js project with CI/CD
2. Create a custom npm package and publish it
3. Build a CLI tool using npx
4. Automate your workflow with npm scripts
5. Contribute to open-source npm packages

---

## References

### Official Documentation
- [Node.js Official Docs](https://nodejs.org/docs)
- [npm Documentation](https://docs.npmjs.com/)
- [package.json Specification](https://docs.npmjs.com/cli/v9/configuring-npm/package-json)
- [Semantic Versioning](https://semver.org/)

### Tools
- [nvm - Node Version Manager](https://github.com/nvm-sh/nvm)
- [pnpm](https://pnpm.io/)
- [npx Documentation](https://www.npmjs.com/package/npx)

### Books & Tutorials
- "Node.js Design Patterns" by Mario Casciaro
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
- [npm-scripts Guide](https://docs.npmjs.com/cli/v9/using-npm/scripts)

### Community
- [Node.js GitHub](https://github.com/nodejs/node)
- [r/node Reddit Community](https://www.reddit.com/r/node/)
- [Node.js Discord](https://discord.gg/nodejs)

---

**Next Lesson:** [29. Node.js Modules and CommonJS](./29.Node.js_Modules_And_CommonJS.md)

**Previous Lesson:** [27. Async Patterns and Best Practices](../13.Asynchronous_JavaScript/27.Async_Patterns_And_Best_Practices.md)
